@using PCStore.UI.Models.Results.ProductResults
@using PCStore.UI.Components
@inject HttpClient Http
@inject IJSRuntime JS

<div class="product-slider-container">
    <div class="product-slider-header">
        <h3>En Çok Satan Ürünler</h3>
    </div>

    @if (isLoading)
    {
        <p>Yükleniyor...</p>
    }
    else if (bestSellers == null || bestSellers.Count == 0)
    {
        <p>En çok satan ürün bulunamadı.</p>
    }
    else
    {
        <div class="product-slider-wrapper">
            <button class="slider-button left" @onclick="() => ScrollSlider(-1)">&#8249;</button>

            <div class="product-slider" @ref="sliderRef">
                @foreach (var product in bestSellers)
                {
                    <ProductCardComponent Product="product" />
                }
            </div>

            <button class="slider-button right" @onclick="() => ScrollSlider(1)">&#8250;</button>
        </div>
    }
</div>

@code {
    private List<ProductCardModel> bestSellers = new();
    private bool isLoading = true;

    private int pageNumber = 1;
    private int pageSize = 10;

    private ElementReference sliderRef;

    protected override async Task OnInitializedAsync()
    {
        isLoading = true;
        try
        {
            var url = $"api/Product/bestseller?pageNumber={pageNumber}&pageSize={pageSize}";
            bestSellers = await Http.GetFromJsonAsync<List<ProductCardModel>>(url);
        }
        catch (Exception ex)
        {
            Console.Error.WriteLine(ex.Message);
            bestSellers = new();
        }
        finally
        {
            isLoading = false;
        }
    }

    private async Task ScrollSlider(int direction)
    {
        await JS.InvokeVoidAsync("sliderScroll.scroll", sliderRef, direction);
    }
}
